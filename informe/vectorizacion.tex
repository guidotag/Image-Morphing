\section{Vectorizaci'on}

En los algoritmos \ref{algo1} y \ref{algo2} se puede ver que t'ecnica se compone de varias partes, claramente divididas. En primer lugar aparece el c'omputo de las interpolaciones. Luego, tenemos la metamorfosis propiamente dicha, etapa en la que se construye cada una de las im'agenes intermedias. Para cada una de ellas, se itera sobre todos los pixeles, y se realizan dos tipos de operaciones: reverse mappings y blending.

Dado que la cantidad de segmentos $s$ suele ser peque\~{n}a, se decidi'o no vectorizar el c'omputo de las interpolaciones. El blending tampoco fue vectorizado, puesto que, suponiendo que tenemos varios p'ixeles de la imagen origen y destino que mezclar, es muy probable que no ocupen posiciones consecutivas, forzando a la realizaci'on de m'ultiples lecturas de memoria necesarias para obtener las componentes RGB de tales pixeles. Por esta raz'on, el 'unico c'omputo en paralelo posible aqu'i ser'ia la cuenta de la ecuaci'on \ref{eq_blend}. Si bien esto podr'ia significar una ganancia de tiempo, es despreciable respecto del costo en que incurrimos al realizar los accesos a memoria, por lo que decidimos no vectorizarlo.

En donde s'i exist'ia una gran posibilidad de vectorizaci'on, es en el reverse mapping, es decir, el algoritmo \ref{algo1}, que tiene la caracter'istica deseable de branching casi inexistente. El 'unico momento en que debe tomar decisiones es al calcular la distancia $d(\mathbf{x}, \mathbf{p}[i]\mathbf{q}[i])$, en la l'inea 8.

La vectorizaci'on de este algoritmo logra computar, para una serie de cuatro pixeles $\mathbf{x}[0]$, $\mathbf{x}[1]$, $\mathbf{x}[2]$, $\mathbf{x}[3]$, el pixel fuente $\mathbf{x'}[0]$, $\mathbf{x'}[1]$, $\mathbf{x'}[2]$, $\mathbf{x'}[3]$ correspondiente a cada uno. La idea atr'as de esta implementaci'on es tomar todas las magnitudes computadas en el algoritmo est'andar ($u$, $v$, las coordenadas de todos los vectores involucrados, etc.), y disponer cada una en un registro XMM distinto. De esta forma, cada registro XMM contiene cuatro valores de una misma magnitud, correspondientes al procesamiento simult'aneo de los cuatro pixeles. En definitiva, esta vectorizaci'on puede pensarse como la ejecuci'on simult'anea de cuatro instancias del algoritmo \ref{algo1}, a trav'es de registros XMM.

Es cuatro es la cantidad de pixeles que se pueden procesar al mismo tiempo, debido a que todas las magnitudes involucradas son n'umeros de punto flotante de precisi'on simple, que tienen 4B de longitud, mientras que los registros XMM tienen 16B de longitud. Todos los c'omputos fueron realizados con representaci'on de punto flotante de dicha precisi'on.